<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>O2: O2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="o2.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">O2<span id="projectnumber">&#160;2.0</span>
   </div>
   <div id="projectbrief">A communication protocol for interactive music and media applications.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">O2 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p >This documentation is divided into modules. Each module describes a different area of functionality: Basics, Return Codes, Low-Level Message Send, and Low-Level Message Parsing.</p>
<h1><a class="anchor" id="Notes"></a>
on Building the O2 Library</h1>
<p >O2 uses CMake, which can create a Linux Makefile, Xcode project, or Visual Studio solution. The basic procedure is run CMake (ccmake on Linux) to create the Makefile of project file, then build using make or your IDE. The main options for CMake are BUILD_MIDI_EXAMPLE: builds an example that depends on PortMidi (disable this option unless you need it), BUILD_STATIC_LIB: builds a static O2 library (recommended), BUILD_TESTS: builds a suite of tests (useful for O2 developers), and BUILD_TESTS_WITH_LIBLO: includes some tests that depends on the OSC library liblo (also useful for O2 developers).</p>
<p >To use O2 in your application, normally you should only need to include the O2 static library <code>o2_static.lib</code> into your project, make sure the path to <a class="el" href="o2_8h.html">o2.h</a> is on your headers search path, and maybe put the path to <code>o2_static.lib</code> on your libraries search path.</p>
<p >O2 depends on some libraries. On Windows, if your application includes O2, you will need to link to <code>winmm.lib</code> and <code>ws2_32.lib</code>. On OS X, you will need to link to the <code>CoreAudio</code> framework. On Linux, you will need to link to <code>asound</code> (you may have to install a developer package to get this), <code>pthread</code>, and <code>m</code> (the math library).</p>
<h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p >O2 is a communication protocol for interactive music and media applications. O2 is inspired by Open Sound Control (OSC) and uses similar means to form addresses, specify types, and encode messages.</p>
<p >However, in addition to providing message delivery, O2 offers a discovery mechanism where processes automatically discover and connect to other processes. Each process can offer zero or more named "services," which are top-level nodes in a global, tree-structured address space for a distributed O2 application. In O2, services replace the notion of network addresses (e.g. 128.2.100.57) in OSC.</p>
<p >O2 is based on IP (Internet Protocol), but there is a mechanism that allows an O2 process to serve as a bridge to other protocols including WebSockets, shared memory, and MQTT. OSC is also supported: An O2 service can be delegated to an OSC server address, and O2 can offer an OSC server that forwards to an O2 service.</p>
<p >O2 addresses begin with the service name. Thus, a complete O2 address would be written simply as "/synth/filterFtoff," where "synth" is the service name.</p>
<p >Furthermore, O2 implements a clock synchronization protocol. A single process is designated as the "reference," and other processes automatically synchronize their local clocks to the reference. All O2 messages are timestamped. Messages are delivered immediately, but their designated operations are invoked according to the timestamp. A timestamp of zero (0.0) means deliver the message immediately. Messages with non-zero timestamps are only deliverable after both the sender and receiver have synchronized clocks.</p>
<p >A service is created using the functions: </p><pre class="fragment">o2_service_new("service_name")
</pre><p> and </p><pre class="fragment">o2_method_new("address," "types," handler, user_data, coerce, parse)
</pre><p> , where <a class="el" href="group__basics.html#gabcdea927caeb653b4f9784955f5dcdb4" title="Add a handler for an address.">o2_method_new</a> is called to install a handler for each node, and each "address" includes the service name as the first node.</p>
<p >Some major components and concepts of O2 are the following:</p>
<ul>
<li><b>Ensemble</b> - a collection of collaborating processes are called an "ensemble." Ensembles are named by a simple ASCII string. In O2, all components belong to an ensemble, and O2 supports communication only <em>within</em> an ensemble. This allows multiple independent ensembles to co-exist and share the same local area network.</li>
<li><b>Host</b> - (conventional definition) a host is a computer (virtual or real) that may host multiple processes. Essentially, a Host is equivalent to an IP address.</li>
<li><b>Process</b> - (conventional definition) an address space and one or more threads. O2 assumes that all processing is performed by a single thread (O2 is not reentrant). A process can offer one or more O2 services and can serve as a client of O2 services in the same or other processes. Each process using O2 has one directory of services shared by all O2 activity in that process (thus, this O2 implementation can be thought of as a "singleton" object). The single O2 instance in a process belongs to one and only one ensemble. O2 does not support communication between ensembles. It is the responsibility of an O2 process to call <a class="el" href="group__basics.html#gab7dba7d7b693586a9d1a854b47f4b64a" title="Process current O2 messages.">o2_poll</a> frequently, giving O2 the opportunity to receive and process messages as well as run background activities for discovery and clock synchronization. <a class="el" href="group__basics.html#gab7dba7d7b693586a9d1a854b47f4b64a" title="Process current O2 messages.">o2_poll</a> is non-blocking.</li>
<li><b>Service</b> - an O2 service is a named server that receives and acts upon O2 messages. A service is addressed by name. Multiple services can exist within one process. A service does not imply a (new) thread and all O2 messages are delivered sequentially from the single thread that calls <a class="el" href="group__basics.html#gab7dba7d7b693586a9d1a854b47f4b64a" title="Process current O2 messages.">o2_poll</a>. Service names begin with a letter with the exception of "_o2" which denotes the local process, "_cs", which denotes the reference clock, and <code>@public:internal:port</code> strings that denote a remote process.</li>
<li><b>Message</b> - an O2 message, similar to an OSC message, contains an address pattern representing a function, a type string and a set of values representing parameters. Messages are delivered to and handled by <em>services</em>. If there are multiple services with the same name, the service with the highest IP address and port number (lexicographically) gets the message. However, the <em>tap</em> mechanism can be used to achieve fan out from a single service (the <em>tappee</em>) to multiple services (<em>tappers</em>).</li>
<li><b>Address Pattern</b> - O2 messages use URL-like addresses, as does OSC, but the top-level node in the hierarchical address space is the service name. Thus, to send a message to the "note" node of the "synth" service, the address pattern might be "/synth/note." The OSC pattern specification language is used unless the first character is "!", e.g. "!synth/note" denotes the same address as "/synth/note" except that O2 can assume that there are no pattern characters such as "*" or "[". The first part of an address is the service name; pattern characters are not allowed in the service name, so the service name must match exactly. A message may be delivered to the service itself, e.g. with address pattern "/synth". To receive such a message, the service must have a single handler that handles every message to the service (see <a class="el" href="group__basics.html#gabcdea927caeb653b4f9784955f5dcdb4" title="Add a handler for an address.">o2_method_new</a>).</li>
<li><b>Scheduler</b> - O2 implements two schedulers for timed message delivery. Schedulers are served by the same <a class="el" href="group__basics.html#gab7dba7d7b693586a9d1a854b47f4b64a" title="Process current O2 messages.">o2_poll</a> call that runs other O2 activity. The <a class="el" href="group__basics.html#ga2df1dd68c5da22e245dfccc898149455" title="Scheduler that schedules according to global (reference) clock time.">o2_gtsched</a> schedules according to the ensemble's reference clock time, but since this depends on clock synchronization, nothing can be scheduled until clock synchronization is achieved (typically within a few seconds of starting the process that provides the reference clock). For local-only services, it is possible to use the <a class="el" href="group__basics.html#gafd163fe7862e0920a67bdca1a5ee02e0" title="Scheduler that schedules according to local clock time.">o2_ltsched</a> scheduler (not with <a class="el" href="group__basics.html#ga8c15f91d7d95ec32345c043409e6a045" title="Construct and send O2 message with best effort protocol.">o2_send</a>, but by explicitly constructing messages and scheduling them with <a class="el" href="group__basics.html#gadb67ebc31f14eed0dd17f398d800f8c3">o2_schedule_msg</a>. In any case, scheduling is useful <em>within</em> a service for any kind of timed activity.</li>
</ul>
<h1><a class="anchor" id="Standard"></a>
Messages</h1>
<p >O2 uses O2 messages for some internal functions and also to communicate status information with O2 processes. Since messages are dropped if there is no handler, O2 processes need not set up handlers for all information.</p>
<p >In the following descriptions, if the <em>service name</em> is <code>@public:internal:port</code> it means the IP address and port number are used to construct a string, e.g. "@4a6dfb76:c0a801a6:fc1d" might be the actual service name.</p>
<h2><a class="anchor" id="Internal"></a>
Messages</h2>
<p ><code>/_o2/dy "sissiii"</code> <em>ensemble_name</em> <em>version</em> <em>public_ip</em> <em>internal_ip</em> <em>tcp_port</em> <em>udp_port</em> <em>dy</em> - this message is normally sent to the discovery port, but it can also be sent as a result of calling <a class="el" href="group__basics.html#gabe395e708be706549ed31dd88b6bdbfb" title="Connect to a hub.">o2_hub</a> and providing an O2 process address. Processes must exchange discovery messages to be connected. The <em>version</em> number encodes the O2 version number of the sender as ((&lt;major-vers&gt; * 256) + &lt;minor-vers&gt;) * 256 + &lt;patch-vers&gt;, where &lt;major-vers&gt;, &lt;minor-vers&gt; and &lt;patch-vers&gt; follow the O2 semantic versioning scheme, e.g. version 2.3.4 would have version number 0x020304. Thus, each component of the 3-part version number ranges from 0 through 255. Connections are completed only if the major version numbers match. The <em>dy</em> parameter is O2_DY_INFO, O2_DY_HUB, O2_DY_REPLY, O2_DY_CALLBACK, O2_DY_CONNECT, or O2_DY_O2LITE, depending on the expected response.</p>
<p ><code>/_o2/hub ""</code> - requests the receiver to become the hub for the sender</p>
<p ><code>/_o2/cs/cs ""</code> - announces when clock sync is obtained.</p>
<p ><code>/_o2/ds ""</code> - this message invokes the sending of discovery messages. It is used with a timestamp to schedule periodic discovery message sending.</p>
<p >`/_cs/get "is" <em>serial-no</em> <em>reply-to</em> - send the time. The <em>reply-to</em> parameter is the full address for the reply. The reply contains the type string "it" and the parameters are the <em>serial-no</em> and the current time.</p>
<p ><code>/_o2/sv "ssbbsi..."</code> <em>process-name</em> <em>service-name</em> <em>add-flag</em> service-flag* <em>tapper-or-properties</em> <em>send_mode</em>... - reports service creation or deletion. Each service is described by name, true, and either true followed by a properties string and zero or false followed by the tapper name and tapper send_mode. If a service is deleted, then false is sent rather than true, and if this is not a tap, the properties string is empty. The "..." notation here indicates that there can be any number of services described in this message, each service consisting of another "sbbsi" (string, Boolean, Boolean, string, int32) sequence. Properties strings are sent with escaped values, a leading ';' and a trailing ';'. This is the first message sent when a process-to-process connection is made.</p>
<h2><a class="anchor" id="API"></a>
Messages</h2>
<p ><code>/_o2/cs/rt "s"</code> <em>reply-to</em> - A process can send this message to request round trip (to the clock reference) information; <em>reply-to</em> is the full address of the reply. The reply message has the type string "sff" and the parameters are the process name (:internal:port), the mean round-trip time, and the minimum round-trip time.</p>
<p ><code>/_o2/cs/ps ""</code> - this message invokes the sending of the <code>/_cs/get</code> message to request the time as part of the clock synchronization protocol.</p>
<p ><code>/_o2/si "siss"</code> <em>service_name</em> <em>status</em> <em>process-name</em> <em>properties</em> - Whenever an active service status changes or service properties change, this message is sent to the local process. Note that when a local service is created, an <em>internal</em> <code>/sv</code> message is sent to all other processes, and when that process's services table is updated, if the service is or becomes active, the change is reported locally to the application by sending this <code>/_o2/si</code> message. Normally, you should not add handlers or use the <code>_o2</code> service, but in this case, an application is expected to add a custom handler to receive status updates. See <a class="el" href="group__basics.html#ga46819340ca66f61bb17059e5542f763a" title="Check the status of the service.">o2_status</a> for a list of status values. O2_UNKNOWN is reported when the current provider of a service is removed. This may be followed immediately by another message to <code>/_o2/si</code> if another provider offers the service. The service <code>_o2</code> is created before you can install a handler for <code>/_o2/si</code>, so you will not receive an <code>si</code> message when <code>_o2</code> is created. If the service name begins with '@', it represents a remote process and the name has the form:internal:port, e.g. <code>@c0a35801:80e8a1a5:d67e</code>. There is also a <code>@public:internal:port</code> service representing the local process, but the local process is also represented by <code>_o2</code>, so the local <code>@public:internal:port</code> service is never reported in an <code>/_o2/si</code> message. Instead, the string <code>"_o2"</code> indicates that <em>process</em> is the local one. You can get the local <code>@public:internal:port</code> string by calling <a class="el" href="group__basics.html#ga1ffea90182bc1799c69c1ba3beceabdd" title="Get IP address and TCP connection port number.">o2_get_addresses</a> or <a class="el" href="group__basics.html#ga6b5570173f79bcf0cecafb3a7338162b" title="Get Public:Local:Port service name string.">o2_get_proc_name</a>. The <em>properties</em> string contains the service properties in the form "attr1:value1;attr2:value2;" with no leading ";". If there are no properties, the string is empty. Values are escaped: within a value, the characters ":;\" are preceded by "\" since ":" and ";" are separator characters. Attribute names are alphanumeric. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
